# tasks for database
- name: Install MariaDB
  apt:
    name: 
      - mariadb-server
      - python3-pymysql
    state: present

- name: Ensure MariaDB is running
  service:
    name: mariadb
    state: started
    enabled: yes

- name: Create mail databases
  mysql_db:
    name: "{{ item }}"
    login_unix_socket: /run/mysqld/mysqld.sock
    state: present
  loop:
    - "{{ mail_db }}"
    - "{{ postfixadmin_db }}"
    - "{{ roundcube_db }}"

- name: Create mail users
  mysql_user:
    name: "{{ item.name }}"
    password: "{{ item.pass }}"
    priv: "{{ item.db }}.*:ALL"
    host: "%"
    state: present
  loop: "{{ mail_db_users }}"
